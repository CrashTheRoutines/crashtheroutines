<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Redirecting...</title>
    <script>
      (async function () {
        const supportedLangs = ["en", "ru", "es"];

        // Проверка, не выбрал ли пользователь язык ранее
        const savedLang = localStorage.getItem("lang");

        // Язык браузера
        const browserLang = navigator.language?.split("-")[0] || "en";

        // Попытка определить страну через Netlify заголовки (если включена функция geolocation)
        let country = null;
        try {
          const res = await fetch("https://ipapi.co/json/"); // Используем внешнюю API
          const data = await res.json();
          country = data.country_code.toLowerCase(); // ru, es, us и т.д.
        } catch (e) {
          country = null;
        }

        // Предполагаемый язык на основе гео
        let geoLang = "en";
        if (country === "ru") geoLang = "ru";
        else if (country === "es") geoLang = "es";

        // Финальный выбор языка
        const lang = supportedLangs.includes(savedLang)
          ? savedLang
          : supportedLangs.includes(browserLang)
          ? browserLang
          : geoLang;

        // Редирект
        window.location.replace(`/${lang}/`);
      })();
    </script>
  </head>
  <body>
    <p>Redirecting based on your language and location...</p>
  </body>
</html>
